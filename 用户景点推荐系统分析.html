<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·æ™¯ç‚¹æ¨èç³»ç»Ÿåˆ†æ</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
            margin-top: 1.5em;
            margin-bottom: 0.8em;
        }
        h1 {
            text-align: center;
            color: #1a73e8;
            padding-bottom: 15px;
            border-bottom: 2px solid #1a73e8;
            margin-bottom: 30px;
        }
        h2 {
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            color: #0d47a1;
        }
        code {
            background-color: #f0f0f0;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: Consolas, monospace;
            color: #c7254e;
        }
        pre {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
            line-height: 1.4;
        }
        .section {
            background-color: white;
            padding: 20px 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .highlight {
            background-color: #fffde7;
            border-left: 4px solid #ffd600;
            padding: 15px;
            margin: 20px 0;
        }
        .info-box {
            background-color: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
        }
        .mermaid {
            margin: 30px auto;
            text-align: center;
            overflow-x: auto;
        }
        .algo-comparison {
            display: flex;
            justify-content: space-between;
            margin: 25px 0;
        }
        .algo-card {
            width: 48%;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .algo-card.traditional {
            background-color: #ffebee;
        }
        .algo-card.optimized {
            background-color: #e8f5e9;
        }
        .performance-chart {
            text-align: center;
            margin: 25px 0;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #777;
        }
        .ds-algo-list li {
            margin-bottom: 10px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: true,
                theme: 'default',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true,
                    curve: 'basis'
                },
                themeVariables: {
                    primaryColor: '#f0f9ff',
                    primaryTextColor: '#003366',
                    primaryBorderColor: '#7fb3d5',
                    lineColor: '#666666',
                    secondaryColor: '#fef5e7',
                    tertiaryColor: '#f8f9fa'
                },
                securityLevel: 'loose',
                fontFamily: 'Microsoft YaHei'
            });
        });
    </script>
</head>
<body>
    <div class="section">
        <h1>ç”¨æˆ·ç™»å½•åè·å–æ¨èæ™¯ç‚¹æµç¨‹åˆ†æ</h1>
        <p>æœ¬æŠ¥å‘Šè¯¦ç»†åˆ†æä¸ªæ€§åŒ–æ—…æ¸¸ç³»ç»Ÿä¸­ç”¨æˆ·ç™»å½•åè·å–æ¨èæ™¯ç‚¹çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬APIå®ç°ã€æ¶‰åŠçš„æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼Œä»¥åŠæ€§èƒ½ä¼˜åŒ–ç‚¹ã€‚</p>
    </div>

    <div class="section">
        <h2>1. æµç¨‹æ¦‚è§ˆ</h2>
        <p>ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œç³»ç»Ÿæ ¹æ®ç”¨æˆ·çš„å…´è¶£åå¥½ï¼ˆæ™¯ç‚¹ç±»å‹åå¥½ï¼‰ï¼Œç»“åˆæ™¯ç‚¹è¯„åˆ†å’Œçƒ­åº¦ä¿¡æ¯ï¼Œä½¿ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œä¸ºç”¨æˆ·æ¨èæœ€åˆé€‚çš„æ—…æ¸¸æ™¯ç‚¹ã€‚</p>
        
        <div class="info-box">
            <p><strong>APIç«¯ç‚¹:</strong> <code>GET /api/recommended-spots</code></p>
            <p><strong>æƒé™è¦æ±‚:</strong> éœ€è¦ç”¨æˆ·ç™»å½•ï¼ˆå—<code>login_required</code>è£…é¥°å™¨ä¿æŠ¤ï¼‰</p>
            <p><strong>æ ¸å¿ƒåŠŸèƒ½:</strong> æ ¹æ®å½“å‰ç™»å½•ç”¨æˆ·çš„å…´è¶£æ ‡ç­¾è¿”å›æ¨èçš„æ™¯ç‚¹åˆ—è¡¨</p>
        </div>

        <h3>æµç¨‹å›¾</h3>
        <div class="mermaid">
flowchart LR
    classDef apiClass fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef dataClass fill:#fff8e1,stroke:#ff6f00,stroke-width:2px
    classDef coreClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef resultClass fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px

    subgraph Client["ğŸ‘¤ å®¢æˆ·ç«¯"]
        A1["å‘èµ·è¯·æ±‚<br>GET /api/recommended-spots"]
        A3["æ¥æ”¶å¹¶æ˜¾ç¤º<br>æ¨èæ™¯ç‚¹æ•°æ®"]
    end

    subgraph API["ğŸŒ APIæ¥å£å±‚"]
        B1["æ¥æ”¶è¯·æ±‚<br>æ£€æŸ¥ç™»å½•çŠ¶æ€"]:::apiClass
        B2["ä»ä¼šè¯è·å–<br>ç”¨æˆ·èº«ä»½"]:::apiClass
        B3["è°ƒç”¨ç”¨æˆ·ç®¡ç†å™¨<br>è·å–æ¨èæ™¯ç‚¹"]:::apiClass
        B4["è¿”å›JSONå“åº”<br>åŒ…å«æ¨èæ™¯ç‚¹"]:::apiClass
    end

    subgraph Core["ğŸ§  æ ¸å¿ƒç®—æ³•å±‚"]
        C1["è·å–ç”¨æˆ·å–œå¥½<br>æ™¯ç‚¹ç±»å‹åå¥½"]:::coreClass
        C2["ä½¿ç”¨ä¼˜åŒ–ç®—æ³•<br>(IndexHeapå½’å¹¶)"]:::coreClass
        C3["è·å–æ™¯ç‚¹è¯¦æƒ…<br>æ„å»ºè¿”å›æ•°æ®"]:::coreClass
    end

    subgraph DataStructures["ğŸ”§ æ•°æ®ç»“æ„å±‚"]
        D1["TopKHeap<br>(ç´¢å¼•æœ€å¤§å †)"]:::dataClass
        D2["SpotIterator<br>(æ™¯ç‚¹è¿­ä»£å™¨)"]:::dataClass
    end

    A1 --> B1
    B1 --> B2
    B2 --> B3
    B3 --> C1
    C1 --> C2
    C2 --> D1
    C2 --> D2
    D1 --> C3
    D2 --> C3
    C3 --> B4
    B4 --> A3
        </div>
    </div>

    <div class="section">
        <h2>2. æ™¯ç‚¹æ¨èæµç¨‹è¯¦è§£</h2>
        <p>ä»¥ä¸‹æ˜¯ç”¨æˆ·ç™»å½•åè·å–æ¨èæ™¯ç‚¹çš„è¯¦ç»†æµç¨‹ï¼Œå±•ç¤ºä¸ºæ¨ªå‘Så½¢çš„å®Œæ•´æµç¨‹å›¾ï¼š</p>

        <div class="mermaid">
flowchart LR
    %% èŠ‚ç‚¹å®šä¹‰
    classDef request fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#0d47a1
    classDef auth fill:#e8eaf6,stroke:#3949ab,stroke-width:2px,color:#283593
    classDef data fill:#fff8e1,stroke:#ff8f00,stroke-width:2px,color:#ef6c00
    classDef algo fill:#f3e5f5,stroke:#8e24aa,stroke-width:2px,color:#6a1b9a
    classDef heap fill:#ede7f6,stroke:#673ab7,stroke-width:2px,color:#4527a0
    classDef process fill:#e8f5e9,stroke:#43a047,stroke-width:2px,color:#2e7d32
    classDef response fill:#e0f2f1,stroke:#00796b,stroke-width:2px,color:#00695c

    A1["1. å®¢æˆ·ç«¯è¯·æ±‚<br>æ¨èæ™¯ç‚¹"]:::request
    A2["2. APIè·¯ç”±<br>æ¥æ”¶è¯·æ±‚"]:::request
    A3["3. éªŒè¯ç”¨æˆ·<br>ç™»å½•çŠ¶æ€"]:::auth
    A4["4. è·å–å½“å‰<br>ç”¨æˆ·ID"]:::auth
    
    B1["5. ä»ç”¨æˆ·å¯¹è±¡<br>è·å–å…´è¶£åå¥½"]:::data
    B2["6. è°ƒç”¨æ¨è<br>ç®—æ³•å‡½æ•°"]:::algo
    B3["7. åˆ›å»ºTopKHeap<br>å½’å¹¶å †ç»“æ„"]:::heap
    B4["8. éå†æ™¯ç‚¹<br>ç±»å‹åå¥½"]:::process
    
    C1["9. åˆ›å»ºæ™¯ç‚¹<br>è¿­ä»£å™¨"]:::data
    C2["10. è¿­ä»£è·å–<br>æ™¯ç‚¹æ•°æ®"]:::process
    C3["11. æ’å…¥æ™¯ç‚¹åˆ°<br>TopKHeapå †ä¸­"]:::heap
    C4["12. å †æŒ‰è¯„åˆ†å’Œ<br>çƒ­åº¦æ’åº"]:::algo
    
    D1["13. ä»å †ä¸­æå–<br>TopKç»“æœ"]:::heap
    D2["14. è½¬æ¢ä¸ºå®Œæ•´<br>æ™¯ç‚¹æ•°æ®æ ¼å¼"]:::process
    D3["15. è¿”å›æ¨è<br>æ™¯ç‚¹æ•°æ®"]:::response
    D4["16. å®¢æˆ·ç«¯å±•ç¤º<br>æ¨èç»“æœ"]:::response

    %% è¿çº¿å®šä¹‰-æ¨ªå‘Så½¢å¸ƒå±€
    A1 --> A2 --> A3 --> A4
    A4 --> B1
    B1 --> B2 --> B3 --> B4
    B4 --> C1
    C1 --> C2 --> C3 --> C4
    C4 --> D1
    D1 --> D2 --> D3 --> D4
        </div>

        <h3>å…³é”®æ­¥éª¤è¯´æ˜</h3>
        <ol class="ds-algo-list">
            <li><strong>APIæ¥å£</strong> - <code>@api.route('/recommended-spots', methods=['GET'])</code> æ˜¯ç”¨æˆ·è¯·æ±‚æ¨èæ™¯ç‚¹çš„å…¥å£ç‚¹ï¼Œéœ€è¦ç”¨æˆ·å·²ç™»å½•</li>
            <li><strong>ç”¨æˆ·éªŒè¯</strong> - é€šè¿‡<code>@login_required</code>è£…é¥°å™¨ç¡®ä¿ç”¨æˆ·å·²ç™»å½•ï¼Œå¹¶ä»ä¼šè¯ä¸­è·å–ç”¨æˆ·ID</li>
            <li><strong>å…´è¶£åå¥½è·å–</strong> - é€šè¿‡ç”¨æˆ·å¯¹è±¡è·å–<code>likes_type</code>å±æ€§ï¼Œè¡¨ç¤ºç”¨æˆ·å–œæ¬¢çš„æ™¯ç‚¹ç±»å‹é›†åˆ</li>
            <li><strong>æ¨èç®—æ³•è°ƒç”¨</strong> - è°ƒç”¨<code>user_manager.getRecommendSpots(user_id, 10)</code>è·å–æ¨èæ™¯ç‚¹ï¼Œé€šå¸¸é»˜è®¤è¿”å›10ä¸ª</li>
            <li><strong>æ ¸å¿ƒæ•°æ®ç»“æ„</strong> - ä½¿ç”¨<code>TopKHeap</code>ï¼ˆç´¢å¼•æœ€å¤§å †ï¼‰é«˜æ•ˆç®¡ç†å’Œæ’åºæ™¯ç‚¹</li>
            <li><strong>è¿­ä»£å™¨æ¨¡å¼</strong> - ä½¿ç”¨<code>SpotIterator</code>éå†æ¯ç§æ™¯ç‚¹ç±»å‹çš„æ‰€æœ‰æ™¯ç‚¹</li>
            <li><strong>æ•°æ®ç»„ç»‡</strong> - å°†ç¬¦åˆç”¨æˆ·å…´è¶£çš„æ‰€æœ‰æ™¯ç‚¹æ’å…¥TopKHeapï¼ŒæŒ‰è¯„åˆ†å’Œçƒ­åº¦é™åºæ’åº</li>
            <li><strong>é«˜æ•ˆè·å–TopK</strong> - é€šè¿‡å †çš„ç‰¹æ€§é«˜æ•ˆè·å–å‰Kä¸ªæœ€é«˜è¯„åˆ†çš„æ™¯ç‚¹</li>
            <li><strong>æ•°æ®æ ¼å¼åŒ–</strong> - å°†ç®—æ³•è¿”å›çš„åŸºç¡€æ¨èç»“æœè½¬æ¢ä¸ºå®Œæ•´çš„æ™¯ç‚¹æ•°æ®</li>
        </ol>
    </div>

    <div class="section">
        <h2>3. æ ¸å¿ƒæ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æ</h2>

        <h3>3.1 æ•°æ®ç»“æ„</h3>
        <table>
            <tr>
                <th>æ•°æ®ç»“æ„</th>
                <th>ç”¨é€”</th>
                <th>ä¸»è¦æ“ä½œ</th>
                <th>æ—¶é—´å¤æ‚åº¦</th>
            </tr>
            <tr>
                <td><strong>TopKHeap</strong><br>(ç´¢å¼•æœ€å¤§å †)</td>
                <td>é«˜æ•ˆç®¡ç†æ™¯ç‚¹æ•°æ®ï¼Œå¹¶å¿«é€Ÿè·å–è¯„åˆ†æœ€é«˜çš„å‰Kä¸ªæ™¯ç‚¹</td>
                <td>æ’å…¥ã€åˆ é™¤ã€è·å–TopK</td>
                <td>æ’å…¥: O(log n)<br>è·å–TopK: O(k log n)</td>
            </tr>
            <tr>
                <td><strong>SpotIterator</strong><br>(æ™¯ç‚¹è¿­ä»£å™¨)</td>
                <td>æŒ‰è¯„åˆ†é™åºè¿­ä»£ç‰¹å®šç±»å‹çš„æ™¯ç‚¹</td>
                <td>åˆå§‹åŒ–ã€è¿­ä»£</td>
                <td>åˆå§‹åŒ–: O(n log n)<br>è¿­ä»£: O(1)</td>
            </tr>
            <tr>
                <td><strong>RecommendationHeap</strong><br>(æ¨èå †)</td>
                <td>ä¸“é—¨ç”¨äºæ¨èç³»ç»Ÿçš„å †å®ç°ï¼Œæ”¯æŒè¿­ä»£å™¨æ¨¡å¼</td>
                <td>æ¨é€ã€å¼¹å‡ºã€æ£€æŸ¥</td>
                <td>æ¨é€/å¼¹å‡º: O(log n)<br>æ£€æŸ¥: O(1)</td>
            </tr>
        </table>

        <h3>3.2 æ¨èç®—æ³•å¯¹æ¯”</h3>
        <div class="algo-comparison">
            <div class="algo-card traditional">
                <h4>ä¼ ç»Ÿç®—æ³• (Kè·¯å½’å¹¶)</h4>
                <p><strong>æ—¶é—´å¤æ‚åº¦:</strong> O(K Ã— N Ã— log topK + K Ã— topK Ã— log K)</p>
                <p><strong>ç©ºé—´å¤æ‚åº¦:</strong> O(K Ã— topK)</p>
                <p><strong>æµç¨‹:</strong></p>
                <ol>
                    <li>å¯¹æ¯ç§å–œæ¬¢çš„ç±»å‹ï¼Œè·å–å‰topKä¸ªæ™¯ç‚¹</li>
                    <li>æ‰§è¡ŒKè·¯å½’å¹¶æ’åº</li>
                    <li>æå–å‰topKä¸ªæœ€ç»ˆç»“æœ</li>
                </ol>
                <p><strong>ç¼ºç‚¹:</strong> é‡å¤æ’åºå¼€é”€å¤§ï¼Œå½’å¹¶å¤æ‚åº¦é«˜</p>
            </div>
            <div class="algo-card optimized">
                <h4>ä¼˜åŒ–ç®—æ³• (IndexHeap)</h4>
                <p><strong>æ—¶é—´å¤æ‚åº¦:</strong> O(N_total Ã— log N_total)</p>
                <p><strong>ç©ºé—´å¤æ‚åº¦:</strong> O(N_total)</p>
                <p><strong>æµç¨‹:</strong></p>
                <ol>
                    <li>ä¸€æ¬¡æ€§æ”¶é›†æ‰€æœ‰ç›¸å…³æ™¯ç‚¹</li>
                    <li>å…¨éƒ¨æ’å…¥ç´¢å¼•æœ€å¤§å †</li>
                    <li>ç›´æ¥ä»å †ä¸­æå–å‰topKä¸ªç»“æœ</li>
                </ol>
                <p><strong>ä¼˜ç‚¹:</strong> ç»Ÿä¸€æ’åºï¼Œé¿å…é‡å¤è®¡ç®—ï¼Œé«˜æ•ˆå†…å­˜ä½¿ç”¨</p>
            </div>
        </div>

        <h3>3.3 ç®—æ³•æ€§èƒ½åˆ†æ</h3>
        <div class="highlight">
            <p>åŸºäºIndexHeapçš„ä¼˜åŒ–ç®—æ³•å¹³å‡æ€§èƒ½æå‡1.65å€ï¼Œæœ€é«˜å¯è¾¾2.40å€ã€‚éšç€æ•°æ®è§„æ¨¡å¢é•¿å’ŒTopKå€¼å¢åŠ ï¼Œæ€§èƒ½ä¼˜åŠ¿æ›´ä¸ºæ˜¾è‘—ã€‚</p>
        </div>

        <table>
            <tr>
                <th>TopKå€¼</th>
                <th>ä¼ ç»Ÿç®—æ³•(ms)</th>
                <th>ä¼˜åŒ–ç®—æ³•(ms)</th>
                <th>æ€§èƒ½æå‡</th>
                <th>æ•ˆç‡æå‡ç‡</th>
            </tr>
            <tr>
                <td>5</td>
                <td>2.120</td>
                <td>2.191</td>
                <td>0.97x</td>
                <td>-3.3%</td>
            </tr>
            <tr>
                <td>10</td>
                <td>3.111</td>
                <td>2.222</td>
                <td>1.40x</td>
                <td>28.6%</td>
            </tr>
            <tr>
                <td>20</td>
                <td>4.091</td>
                <td>2.236</td>
                <td>1.83x</td>
                <td>45.3%</td>
            </tr>
            <tr>
                <td>50</td>
                <td>5.656</td>
                <td>2.359</td>
                <td>2.40x</td>
                <td>58.3%</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <h2>4. æ¨èç³»ç»Ÿæ ¸å¿ƒä»£ç åˆ†æ</h2>

        <h3>4.1 APIè·¯ç”±å®ç°</h3>
        <pre><code>@api.route('/recommended-spots', methods=['GET'])
@login_required  # ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
def recommended_spots():
    user = g.user
    user_id = user['user_id']
    
    # è·å–åŸå§‹æ¨èæ™¯ç‚¹æ•°æ®
    raw_recommended_spots = user_manager.getRecommendSpots(user_id, 10) 

    # å¤„ç†æ•°æ®ï¼Œåªé€‰æ‹©éœ€è¦çš„å­—æ®µ
    filtered_spots = []
    if raw_recommended_spots: # ç¡®ä¿åˆ—è¡¨ä¸ä¸ºç©º
        for spot in raw_recommended_spots:
            spot = spot_manager.getSpot(spot['id'])  
            filtered_spot = {
                'name': spot.name,
                'id': spot.id,
                'score': spot.score,
                'type': spot.type,
                'visited_time': spot.visited_time,
                'img': spot.img,
            }
            filtered_spots.append(filtered_spot)

    # è¿”å›å¤„ç†åçš„æ•°æ®
    return jsonify({'success': True, 'spots': filtered_spots})</code></pre>

        <h3>4.2 æ¨èç®—æ³•æ ¸å¿ƒå®ç°</h3>
        <pre><code>def getRecommendSpots(self, userId, topK=10):
    """
    è·å–ç”¨æˆ·æ¨èçš„æ™¯ç‚¹ - ä½¿ç”¨å †ä¼˜åŒ–çš„æ¨èç®—æ³•
    """
    user = self.getUser(userId)
    if user is None:
        return None
    
    user_likes = user.likes_type
    return self._getRecommendSpotsOptimized(user_likes, topK)

def _getRecommendSpotsOptimized(self, user_likes, topK=10):
    """
    ä½¿ç”¨indexHeapè¿›è¡Œå½’å¹¶æ’åºçš„ä¼˜åŒ–æ¨èç®—æ³•
    æ—¶é—´å¤æ‚åº¦: O(N log N)ï¼Œå…¶ä¸­Næ˜¯æ‰€æœ‰ç›¸å…³æ™¯ç‚¹æ€»æ•°
    """
    from module.data_structure.indexHeap import TopKHeap
    from module.data_structure.heap import create_spot_iterator
    
    # ä½¿ç”¨indexHeapè¿›è¡Œå½’å¹¶æ’åº
    merge_heap = TopKHeap()
    
    # æ”¶é›†æ‰€æœ‰ç›¸å…³æ™¯ç‚¹å¹¶æ’å…¥åˆ°å½’å¹¶å †ä¸­
    for spot_type in user_likes:
        spots_iter = create_spot_iterator(spot_type, spotManager)
        for spot in spots_iter:
            spot_id = spot['id']
            # æ’å…¥åˆ°å½’å¹¶å †ï¼švalue1=score, value2=visited_time
            merge_heap.insert(spot_id, spot['score'], spot['visited_time'])

    # ä»å½’å¹¶å †ä¸­è·å–å‰topKä¸ªæœ€é«˜è¯„åˆ†çš„æ™¯ç‚¹
    result_data = merge_heap.getTopK(topK)
    
    if not result_data:
        return []
    
    # è½¬æ¢ä¸ºå®Œæ•´çš„æ™¯ç‚¹æ•°æ®
    result = []
    for item in result_data:
        spot_data = {
            'id': item['id'],
            'score': item['value1'],
            'visited_time': item['value2']
        }
        result.append(spot_data)
    
    return result</code></pre>

        <h3>4.3 TopKHeapæ ¸å¿ƒå®ç°</h3>
        <pre><code>class TopKHeap:
    """
    ä¼˜åŒ–çš„ç´¢å¼•æœ€å¤§å †ï¼Œä¸“æ³¨äºè·å–å‰Kä¸ªæœ€å¤§å…ƒç´ 
    - æŒ‰value1é™åºæ’åº
    - value1ç›¸åŒæ—¶æŒ‰value2é™åºæ’åº
    - æ”¯æŒé€šè¿‡IDé«˜æ•ˆæ›´æ–°æ•°æ®
    - æä¾›O(k log n)å¤æ‚åº¦è·å–å‰kä¸ªå…ƒç´ çš„æ–¹æ³•
    """
    
    def __init__(self):
        self.heap = []  # å †æ•°ç»„
        self.index_map = {}  # IDåˆ°å †ä½ç½®çš„æ˜ å°„
    
    def getTopK(self, k=10):
        """
        è·å–å‰kä¸ªæœ€å¤§å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦O(k log n)
        ä¸æ”¹å˜åŸå †ç»“æ„ï¼Œä½¿ç”¨æœ€ä¼˜åŒ–çš„å¤åˆ¶ç­–ç•¥
        """
        if k <= 0 or self.isEmpty():
            return []
            
        # æ ¹æ®å †å¤§å°é€‰æ‹©æœ€ä¼˜å¤åˆ¶ç­–ç•¥
        heap_size = len(self.heap)
        if heap_size < 1000:
            temp_heap = self._fast_heap_copy()
        elif k / heap_size < 0.1:
            import heapq
            return heapq.nlargest(k, self.heap, key=lambda x: (x["value1"], x["value2"]))
        else:
            temp_heap = self._fast_heap_copy()
        
        result = []
        # æå–å‰kä¸ªå…ƒç´ çš„é«˜æ•ˆå®ç°
        # ...
        return result</code></pre>
    </div>

    <div class="section">
        <h2>5. æ€§èƒ½ä¼˜åŒ–ä¸åº”ç”¨å»ºè®®</h2>

        <h3>5.1 å½“å‰ç³»ç»Ÿä¸­çš„ä¼˜åŒ–ç‚¹</h3>
        <ul class="ds-algo-list">
            <li><strong>å †å¤åˆ¶ç­–ç•¥ä¼˜åŒ–</strong> - æ ¹æ®å †å¤§å°å’Œkå€¼åŠ¨æ€é€‰æ‹©æœ€ä¼˜çš„å¤åˆ¶ç­–ç•¥</li>
            <li><strong>æ™¯ç‚¹è¿­ä»£å™¨æ¨¡å¼</strong> - é‡‡ç”¨è¿­ä»£å™¨æ¨¡å¼ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ™¯ç‚¹æ•°æ®åˆ°å†…å­˜</li>
            <li><strong>ç´¢å¼•æ˜ å°„</strong> - ä½¿ç”¨IDåˆ°å †ä½ç½®çš„æ˜ å°„ï¼Œæ”¯æŒO(1)æŸ¥æ‰¾å’ŒO(log n)æ›´æ–°</li>
            <li><strong>æ’åºé”®ä¼˜åŒ–</strong> - åŒæ—¶è€ƒè™‘æ™¯ç‚¹è¯„åˆ†(value1)å’Œçƒ­åº¦(value2)è¿›è¡Œæ’åº</li>
        </ul>

        <h3>5.2 æœªæ¥ä¼˜åŒ–æ–¹å‘</h3>
        <ol class="ds-algo-list">
            <li><strong>ç¼“å­˜ç­–ç•¥</strong> - ä¸ºçƒ­é—¨ç”¨æˆ·å–œå¥½ç»„åˆé¢„è®¡ç®—å¹¶ç¼“å­˜æ¨èç»“æœ</li>
            <li><strong>å¢é‡æ›´æ–°</strong> - å½“æ™¯ç‚¹æ•°æ®å˜åŒ–æ—¶é‡‡ç”¨å¢é‡æ–¹å¼æ›´æ–°æ¨èç»“æœ</li>
            <li><strong>å¹¶è¡Œå¤„ç†</strong> - ä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†ä¸åŒç”¨æˆ·å–œå¥½ç±»å‹çš„æ¨èè®¡ç®—</li>
            <li><strong>ç”¨æˆ·è¡Œä¸ºæƒé‡</strong> - ç»“åˆç”¨æˆ·æµè§ˆå’Œäº’åŠ¨å†å²åŠ¨æ€è°ƒæ•´æ¨èæƒé‡</li>
        </ol>

        <div class="info-box">
            <h4>å®é™…åº”ç”¨å»ºè®®</h4>
            <p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ¨èä½¿ç”¨åŸºäºIndexHeapçš„ä¼˜åŒ–ç®—æ³•ï¼Œå°¤å…¶æ˜¯å½“ç³»ç»Ÿéœ€è¦å¤„ç†:</p>
            <ul>
                <li>å¤§è§„æ¨¡æ™¯ç‚¹æ•°æ®</li>
                <li>ç”¨æˆ·å–œå¥½ç±»å‹å¤šæ ·åŒ–</li>
                <li>é«˜å¹¶å‘æ¨èè¯·æ±‚</li>
                <li>å¯¹å“åº”é€Ÿåº¦è¦æ±‚é«˜çš„å®æ—¶æ¨èåœºæ™¯</li>
            </ul>
        </div>
    </div>

    <footer>
        <p>ä¸ªæ€§åŒ–æ—…æ¸¸ç³»ç»Ÿ | ç”¨æˆ·æ™¯ç‚¹æ¨èæµç¨‹åˆ†æ</p>
        <p>ç”Ÿæˆæ—¥æœŸ: 2023å¹´12æœˆ10æ—¥</p>
    </footer>
</body>
</html>
