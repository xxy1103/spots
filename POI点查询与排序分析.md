# POIç‚¹æŸ¥è¯¢ä¸åŸºäºè·¯å¾„è·ç¦»çš„æ’åºç³»ç»Ÿåˆ†æ

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

POIï¼ˆPoint of Interestï¼Œå…´è¶£ç‚¹ï¼‰æŸ¥è¯¢ä¸æ’åºç³»ç»Ÿæ˜¯ä¸ªæ€§åŒ–æ—…æ¸¸ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼Œè´Ÿè´£ä¸ºç”¨æˆ·æä¾›æ™ºèƒ½åŒ–çš„å‘¨è¾¹å…´è¶£ç‚¹æ¨èæœåŠ¡ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **POIæŸ¥è¯¢**ï¼šåŸºäºç™¾åº¦åœ°å›¾APIï¼ŒæŒ‰ç±»å‹å’Œä½ç½®æœç´¢å‘¨è¾¹å…´è¶£ç‚¹
- **è·¯å¾„è·ç¦»è®¡ç®—**ï¼šä½¿ç”¨Dijkstraç®—æ³•è®¡ç®—çœŸå®è·¯å¾„è·ç¦»
- **æ™ºèƒ½æ’åº**ï¼šåŸºäºè·ç¦»å’Œè¯„åˆ†çš„å¤šç»´åº¦æ’åº
- **ç±»å‹åˆå¹¶**ï¼šä½¿ç”¨Kè·¯å½’å¹¶ç®—æ³•æ•´åˆå¤šç±»å‹POI
- **åæ ‡è½¬æ¢**ï¼šWGS84ä¸GCJ02åæ ‡ç³»ç»Ÿè½¬æ¢

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    A[ç”¨æˆ·è¯·æ±‚] --> B{è¯·æ±‚ç±»å‹}
    B -->|å•ä¸€POIç±»å‹| C[getPoiByKeyword]
    B -->|æ‰€æœ‰POIç±»å‹| D[getPoi]
    B -->|æŒ‡å®šæ™¯ç‚¹POI| E[getPoiData]
    
    C --> F[Map.get_POI_reversal]
    D --> G[éå†æ‰€æœ‰POIç±»å‹]
    E --> F
    
    G --> H[å¤šæ¬¡è°ƒç”¨get_POI_reversal]
    H --> I[Kè·¯å½’å¹¶æ’åº]
    F --> J[POISearch.search]
    
    J --> K[ç™¾åº¦åœ°å›¾APIè°ƒç”¨]
    K --> L[åæ ‡ç³»è½¬æ¢]
    L --> M[POIè¯¦æƒ…æå–]
    M --> N{ä½¿ç”¨Dijkstra?}
    
    N -->|æ˜¯| O[Dijkstraè·ç¦»è®¡ç®—]
    N -->|å¦| P[ç›´çº¿è·ç¦»è®¡ç®—]
    
    O --> Q[å¿«é€Ÿæ’åº]
    P --> Q
    Q --> R[è¿”å›æ’åºç»“æœ]
    
    I --> S[åˆ—è¡¨åè½¬]
    S --> T[JSONå“åº”]
    R --> T
```

### ğŸ“¦ æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | æ–‡ä»¶è·¯å¾„ | ä¸»è¦èŒè´£ | å…³é”®æ–¹æ³• |
|------|----------|----------|----------|
| è·¯ç”±å±‚ | app/map/routes.py | HTTPè¯·æ±‚å¤„ç†ä¸å“åº” | getPoi, getPoiByKeyword, getPoiData |
| ä¸šåŠ¡å±‚ | module/map.py | POIä¸šåŠ¡é€»è¾‘å°è£… | get_POI_reversal |
| æœç´¢å¼•æ“ | module/data_structure/POiSearch.py | POIæœç´¢ä¸æ•°æ®å¤„ç† | search, get_poi_details |
| è·¯å¾„è®¡ç®— | module/data_structure/dijkstra.py | æœ€çŸ­è·¯å¾„ç®—æ³•å®ç° | calculate_distances_to_points |
| æ’åºç®—æ³• | module/data_structure/quicksort.py | å¿«é€Ÿæ’åºå®ç° | quicksort, partition |
| åˆå¹¶ç®—æ³• | module/data_structure/kwaymerge.py | Kè·¯å½’å¹¶æ’åº | k_way_merge_descending |

## ğŸ”Œ APIæ¥å£è¯¦è§£

### æ¥å£1ï¼šè·å–æ‰€æœ‰ç±»å‹POI
- **è·¯å¾„**ï¼š`/api/poi/<location>`
- **åŠŸèƒ½**ï¼šæŸ¥è¯¢æŒ‡å®šä½ç½®æ‰€æœ‰ç±»å‹çš„POIå¹¶åˆå¹¶æ’åº
- **æµç¨‹**ï¼šéå†POIç±»å‹ â†’ å¹¶è¡ŒæŸ¥è¯¢ â†’ Kè·¯å½’å¹¶ â†’ åè½¬æ’åº

### æ¥å£2ï¼šæŒ‰å…³é”®è¯æŸ¥è¯¢POI
- **è·¯å¾„**ï¼š`/api/poi/<location>/<keyword>`
- **åŠŸèƒ½**ï¼šæ ¹æ®å…³é”®è¯æŸ¥è¯¢ç‰¹å®šç±»å‹çš„POI
- **æµç¨‹**ï¼šå•ä¸€ç±»å‹æŸ¥è¯¢ â†’ æ’åº â†’ åè½¬è¿”å›

### æ¥å£3ï¼šæ™¯ç‚¹å‘¨è¾¹POI
- **è·¯å¾„**ï¼š`/api/poi/data/<int:spot_id>`
- **åŠŸèƒ½**ï¼šè·å–æŒ‡å®šæ™¯ç‚¹å‘¨è¾¹çš„é»˜è®¤POI
- **æµç¨‹**ï¼šæ™¯ç‚¹å®šä½ â†’ å‘¨è¾¹æœç´¢ â†’ è·ç¦»æ’åº

### ğŸ·ï¸ æ”¯æŒçš„POIç±»å‹
ç³»ç»Ÿæ”¯æŒ10ç§POIç±»å‹ï¼šé¤å…ã€é…’åº—ã€è¶…å¸‚ã€åŒ»é™¢ã€é“¶è¡Œã€åŠ æ²¹ç«™ã€åœè½¦åœºã€å¥¶èŒ¶åº—ã€æ¸¸å®¢ä¸­å¿ƒã€å•æ‰€

## ğŸ” æ ¸å¿ƒç®—æ³•å®ç°

### 1. POIæœç´¢ç®—æ³•

```python
def search(self, query, location, radius=500):
    # 1. åæ ‡è½¬æ¢ï¼šWGS84 â†’ GCJ02
    lat, lng = map(float, location.split(","))
    result = wgs84_to_gcj02(lng, lat)
    location = f"{result[1]},{result[0]}"
    
    # 2. æ„å»ºAPIè¯·æ±‚å‚æ•°
    params = {
        "query": query,
        "location": location,
        "radius": radius,
        "ak": self.ak,
        "coord_type": 2,  # GCJ02åæ ‡
    }
    
    # 3. è°ƒç”¨ç™¾åº¦åœ°å›¾API
    response = requests.get(url=self.host + self.uri, params=params)
    return response.json(), query
```

### 2. Dijkstraå¤šç›®æ ‡è·ç¦»è®¡ç®—

```python
def calculate_distances_to_points(self, start_coordinate, target_points):
    # è·å–èµ·ç‚¹å’Œç›®æ ‡ç‚¹çš„æœ€è¿‘èŠ‚ç‚¹
    start_node = self.get_nearest_node(start_lat, start_lng)
    target_nodes = [self.get_nearest_node(point["location"]["lat"], 
                                         point["location"]["lng"]) 
                   for point in target_points]
    
    # å•æºå¤šç›®æ ‡Dijkstraç®—æ³•
    distances = self._dijkstra_multi_target(start_node, target_nodes)
    
    # å°†è·ç¦»ç»“æœå†™å…¥POIå¯¹è±¡
    for i, point in enumerate(target_points):
        point["value1"] = round(distances.get(target_nodes[i], float('inf')), 1)
    
    return target_points
```

### 3. å¿«é€Ÿæ’åºç®—æ³•ï¼ˆåŒé‡æ¡ä»¶ï¼‰

```python
def quicksort(data_list, sort_key=None):
    """
    æ”¯æŒåŒé‡æ’åºæ¡ä»¶ï¼š
    - ä¸»æ’åºé”®ï¼švalue1ï¼ˆè·ç¦»ï¼‰ï¼Œé™åº
    - æ¬¡æ’åºé”®ï¼švalue2ï¼ˆè¯„åˆ†ï¼‰ï¼Œé™åº
    """
    def partition(arr, low, high):
        pivot = arr[high]
        i = low - 1
        
        for j in range(low, high):
            # ä¸»æ’åºé”®æ¯”è¾ƒï¼ˆé™åºï¼‰
            if arr[j]['value1'] > pivot['value1']:
                should_swap = True
            elif arr[j]['value1'] == pivot['value1']:
                # æ¬¡æ’åºé”®æ¯”è¾ƒï¼ˆé™åºï¼‰
                should_swap = arr[j]['value2'] >= pivot['value2']
            else:
                should_swap = False
            
            if should_swap:
                i += 1
                arr[i], arr[j] = arr[j], arr[i]
        
        arr[i + 1], arr[high] = arr[high], arr[i + 1]
        return i + 1
    
    # é€’å½’å¿«é€Ÿæ’åº
    quicksort_recursive(data_list, 0, len(data_list) - 1)
    return data_list
```

### 4. Kè·¯å½’å¹¶ç®—æ³•

```python
def k_way_merge_descending(list_of_lists):
    """
    ä½¿ç”¨æœ€å°å †å®ç°Kè·¯å½’å¹¶ï¼Œä¿æŒé™åºæ’åˆ—
    """
    min_heap = MinHeap()
    result = []
    
    # åˆå§‹åŒ–å †ï¼šæ¯ä¸ªåˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ å…¥å †
    for i, sub_list in enumerate(list_of_lists):
        if sub_list:
            item = sub_list[0]
            heap_item = (
                -item['value1'],    # è´Ÿå€¼å®ç°é™åº
                -item['value2'],    # è´Ÿå€¼å®ç°é™åº
                i,                  # åˆ—è¡¨ç´¢å¼•
                0,                  # å…ƒç´ ç´¢å¼•
                item               # åŸå§‹å¯¹è±¡
            )
            min_heap.push(heap_item)
    
    # å½’å¹¶è¿‡ç¨‹
    while not min_heap.is_empty():
        _, _, list_idx, item_idx, current_item = min_heap.pop()
        result.append(current_item)
        
        # æ·»åŠ ä¸‹ä¸€ä¸ªå…ƒç´ åˆ°å †ä¸­
        next_idx = item_idx + 1
        if next_idx < len(list_of_lists[list_idx]):
            next_item = list_of_lists[list_idx][next_idx]
            min_heap.push((
                -next_item['value1'],
                -next_item['value2'],
                list_idx,
                next_idx,
                next_item
            ))
    
    return result
```

## ğŸ—ï¸ æ•°æ®ç»“æ„åˆ†æ

### POIå¯¹è±¡ç»“æ„
```python
poi_info = {
    "name": "POIåç§°",           # å…´è¶£ç‚¹åç§°
    "type": "POIç±»å‹",           # é¤å…ã€é…’åº—ç­‰
    "address": "è¯¦ç»†åœ°å€",        # å®Œæ•´åœ°å€ä¿¡æ¯
    "location": {               # åæ ‡ä¿¡æ¯
        "lat": çº¬åº¦,            # çº¬åº¦ï¼ˆWGS84ï¼‰
        "lng": ç»åº¦             # ç»åº¦ï¼ˆWGS84ï¼‰
    },
    "value1": è·ç¦»å€¼,           # è·¯å¾„è·ç¦»ï¼ˆç±³ï¼‰
    "value2": è¯„åˆ†å€¼            # è¯„åˆ†æˆ–å…¶ä»–æŒ‡æ ‡
}
```

### æ ¸å¿ƒæ•°æ®ç»“æ„

| æ•°æ®ç»“æ„ | ç”¨é€” | æ“ä½œå¤æ‚åº¦ | è¯´æ˜ |
|----------|------|------------|------|
| MinHeap | Kè·¯å½’å¹¶çš„ä¼˜å…ˆé˜Ÿåˆ— | O(log n) | ç»´æŠ¤å¤šè·¯å½’å¹¶çš„æœ‰åºæ€§ |
| Graph | åœ°å›¾è·¯ç½‘è¡¨ç¤º | O(1) - O(degree) | æ”¯æŒDijkstraç®—æ³• |
| MySet | Dijkstraè®¿é—®æ ‡è®° | O(1) å¹³å‡ | å¿«é€ŸæŸ¥è¯¢å’Œæ ‡è®° |
| POIå¯¹è±¡ | å­˜å‚¨POIä¿¡æ¯ | O(1) | æ”¯æŒå¤šç»´æ’åº |

## â±ï¸ å¤æ‚åº¦åˆ†æ

### æ—¶é—´å¤æ‚åº¦

| ç®—æ³•/æ“ä½œ | æœ€å¥½æƒ…å†µ | å¹³å‡æƒ…å†µ | æœ€åæƒ…å†µ | è¯´æ˜ |
|-----------|----------|----------|----------|------|
| POIæœç´¢ï¼ˆAPIè°ƒç”¨ï¼‰ | O(1) | O(1) | O(1) | ç½‘ç»œè¯·æ±‚ï¼Œä¸æ•°æ®é‡æ— å…³ |
| å¿«é€Ÿæ’åº | O(n log n) | O(n log n) | O(nÂ²) | nä¸ºPOIæ•°é‡ |
| Dijkstraå¤šç›®æ ‡ | O((V + E) log V) | O((V + E) log V) | O((V + E) log V) | Vä¸ºèŠ‚ç‚¹æ•°ï¼ŒEä¸ºè¾¹æ•° |
| Kè·¯å½’å¹¶ | O(n log k) | O(n log k) | O(n log k) | nä¸ºæ€»å…ƒç´ æ•°ï¼Œkä¸ºåˆ—è¡¨æ•° |
| åæ ‡è½¬æ¢ | O(1) | O(1) | O(1) | æ•°å­¦è®¡ç®—ï¼Œå¸¸æ•°æ—¶é—´ |

### ç©ºé—´å¤æ‚åº¦

- **POIå­˜å‚¨ç©ºé—´**ï¼šO(n Ã— m)ï¼Œnä¸ºPOIæ•°é‡ï¼Œmä¸ºæ¯ä¸ªPOIçš„å±æ€§æ•°é‡
- **Dijkstraç®—æ³•ç©ºé—´**ï¼šO(V + E)ï¼ŒVä¸ºå›¾èŠ‚ç‚¹æ•°ï¼ŒEä¸ºè¾¹æ•°
- **å †ç©ºé—´å ç”¨**ï¼šO(k)ï¼Œkä¸ºå‚ä¸å½’å¹¶çš„åˆ—è¡¨æ•°é‡
- **æ€»ä½“ç©ºé—´å¤æ‚åº¦**ï¼šO(n Ã— m + V + E)

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### å·²å®ç°çš„ä¼˜åŒ–ç­–ç•¥

1. **ç®—æ³•å±‚é¢ä¼˜åŒ–**
   - å•æºå¤šç›®æ ‡Dijkstraï¼šé¿å…å¤šæ¬¡ç‹¬ç«‹è®¡ç®—
   - å¿«é€Ÿæ’åºåŒé‡æ¡ä»¶ï¼šä¸€æ¬¡æ’åºå®Œæˆå¤šç»´æ’åº
   - Kè·¯å½’å¹¶å‡å°‘æ¯”è¾ƒï¼šä½¿ç”¨å †ä¼˜åŒ–åˆå¹¶è¿‡ç¨‹
   - å †ä¼˜åŒ–çš„ä¼˜å…ˆé˜Ÿåˆ—ï¼šæé«˜æ’åºæ•ˆç‡

2. **ç³»ç»Ÿæ¶æ„ä¼˜åŒ–**
   - å»¶è¿Ÿåˆå§‹åŒ–ç»„ä»¶ï¼šæŒ‰éœ€åˆ›å»ºï¼Œå‡å°‘å†…å­˜å ç”¨
   - å¤±è´¥è‡ªåŠ¨å›é€€æœºåˆ¶ï¼šDijkstraå¤±è´¥æ—¶å›é€€åˆ°ç›´çº¿è·ç¦»
   - åˆ†å±‚æ¨¡å—åŒ–è®¾è®¡ï¼šèŒè´£åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤
   - å®Œå–„å¼‚å¸¸å¤„ç†ï¼šä¿è¯ç³»ç»Ÿç¨³å®šæ€§

3. **æ•°æ®å¤„ç†ä¼˜åŒ–**
   - åæ ‡ç³»ç»Ÿä¸€è½¬æ¢ï¼šè‡ªåŠ¨å¤„ç†åæ ‡ç³»å·®å¼‚
   - APIåˆ†é¡µæŸ¥è¯¢ï¼šé¿å…ä¸€æ¬¡åŠ è½½å¤§é‡æ•°æ®
   - ç»“æœç²¾åº¦æ§åˆ¶ï¼šè·ç¦»ä¿ç•™ä¸€ä½å°æ•°
   - æ•°æ®ç»“æ„ä¼˜åŒ–ï¼šé€‰æ‹©é€‚åˆçš„æ•°æ®ç»“æ„

### æ€§èƒ½æå‡æ•ˆæœ

| ä¼˜åŒ–é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡æ¯”ä¾‹ | ä¼˜åŒ–æ–¹æ³• |
|----------|--------|--------|----------|----------|
| è·ç¦»è®¡ç®— | O(n Ã— (V + E) log V) | O((V + E) log V) | nå€æå‡ | å•æºå¤šç›®æ ‡ç®—æ³• |
| å¤šç±»å‹åˆå¹¶ | O(nÂ² log n) | O(n log k) | æ˜¾è‘—æå‡ | Kè·¯å½’å¹¶ç®—æ³• |
| å†…å­˜å ç”¨ | å¸¸é©»åŠ è½½ | æŒ‰éœ€åˆ›å»º | 30-50%å‡å°‘ | å»¶è¿Ÿåˆå§‹åŒ– |
| é”™è¯¯å¤„ç† | ç³»ç»Ÿå´©æºƒ | ä¼˜é›…é™çº§ | 100%å¯ç”¨æ€§ | å¼‚å¸¸æ•è·+å›é€€ |

## ğŸ”® è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜æœºåˆ¶**ï¼šç¼“å­˜çƒ­ç‚¹åŒºåŸŸçš„POIæŸ¥è¯¢ç»“æœï¼Œå‡å°‘APIè°ƒç”¨
2. **å¹¶å‘æŸ¥è¯¢**ï¼šå¤šçº¿ç¨‹å¹¶å‘è°ƒç”¨ä¸åŒç±»å‹çš„POIæŸ¥è¯¢
3. **é¢„è®¡ç®—**ï¼šå¯¹çƒ­é—¨æ™¯ç‚¹é¢„è®¡ç®—å‘¨è¾¹POIï¼Œæé«˜å“åº”é€Ÿåº¦
4. **æ™ºèƒ½åˆ†é¡µ**ï¼šæ ¹æ®ç”¨æˆ·è¡Œä¸ºåŠ¨æ€è°ƒæ•´åˆ†é¡µå¤§å°
5. **ç»“æœé¢„æµ‹**ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹ç”¨æˆ·å¯èƒ½æ„Ÿå…´è¶£çš„POIç±»å‹

## ğŸ“‹ æ€»ç»“

### ğŸ¯ ç³»ç»Ÿä¼˜åŠ¿

1. **æ™ºèƒ½ç®—æ³•**ï¼šç»“åˆå¤šç§é«˜æ•ˆç®—æ³•å®ç°POIæ™ºèƒ½æ’åº
2. **çœŸå®è·ç¦»**ï¼šåŸºäºè·¯ç½‘çš„çœŸå®è·¯å¾„è·ç¦»è®¡ç®—ï¼Œè€Œéç›´çº¿è·ç¦»
3. **å¤šç»´æ’åº**ï¼šæ”¯æŒè·ç¦»ã€è¯„åˆ†ç­‰å¤šç»´åº¦ç»¼åˆæ’åº
4. **é«˜å¯ç”¨æ€§**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé™çº§æœºåˆ¶
5. **æ‰©å±•æ€§å¼º**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°çš„POIç±»å‹å’Œæ’åºè§„åˆ™

### ğŸ“ˆ æŠ€æœ¯åˆ›æ–°ç‚¹

- å•æºå¤šç›®æ ‡Dijkstraç®—æ³•çš„åˆ›æ–°åº”ç”¨
- Kè·¯å½’å¹¶åœ¨POIåˆå¹¶ä¸­çš„é«˜æ•ˆå®ç°
- åæ ‡ç³»è½¬æ¢çš„è‡ªåŠ¨åŒ–å¤„ç†
- åˆ†å±‚æ¶æ„çš„ä¼˜é›…è®¾è®¡

POIç‚¹æŸ¥è¯¢ä¸æ’åºç³»ç»Ÿé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„ç®—æ³•ç»„åˆå’Œç³»ç»Ÿæ¶æ„ï¼Œä¸ºä¸ªæ€§åŒ–æ—…æ¸¸ç³»ç»Ÿæä¾›äº†é«˜æ•ˆã€å‡†ç¡®ã€å¯é çš„å…´è¶£ç‚¹æ¨èæœåŠ¡ï¼Œæ˜¯ç³»ç»Ÿç”¨æˆ·ä½“éªŒçš„é‡è¦ä¿éšœã€‚
