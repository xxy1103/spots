<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êé®ËçêÊôØÁÇπ</title>
    <link rel="icon" href="../static/logo.png" type="image/png">
    <link rel="shortcut icon" href="../static/logo.png" type="image/png">
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        
        .white-container {
            position: absolute;
            top: 185px;
            left: 0;
            width: 100%;
            height: 100px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 0 10px;
        }
        
        .category-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 80px;
            text-decoration: none;
            color: #333;
            transition: background-color 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .category-item:hover {
            background-color: #f0f0f0;
        }
        
        .category-icon {
            width: 40px;
            height: 40px;
            margin-bottom: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .category-icon i {
            font-size: 30px;
            color: #0052d9;
            font-style: normal;
        }
        
        .category-item span {
            font-size: 14px;
            text-align: center;
        }
        
        /* ÈÄâÈ°πÂç°ÂØºËà™Ê†∑Âºè */
        .tabs-container {
            position: absolute;
            top: 305px;
            left: 0;
            width: 100%;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .tabs-nav {
            display: flex;
            justify-content: center;
            border-bottom: 1px solid #eee;
            width: 70%;
            margin-bottom: 15px;
        }
        
        .tab-item {
            padding: 10px 30px;
            text-decoration: none;
            color: #333;
            font-size: 16px;
            position: relative;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .tab-item.active {
            color: #0052d9;
        }
        
        .tab-item.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #0052d9;
        }
        
        .tab-content {
            display: none;
            width: 80%;
            margin: 0 auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .spots-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(2, auto);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .spot-card {
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            background-color: white;
            width: 100%;
            max-width: 290px;
            margin: 0 auto;
        }
        
        .spot-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .spot-card img {
            width: 100%;
            height: 130px;
            object-fit: cover;
        }
        
        .spot-card-info {
            padding: 10px;
        }
        
        .spot-card-info h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
            font-weight: bold;
            display: inline-block;
        }
        
        .spot-location {
            color: #888;
            font-size: 0.9em;
            float: right;
        }
        
        .blue-container {
            position: absolute;
            top: 125px;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: #0052d9;
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 60px;
        }
        
        .nav-item {
            color: white;
            font-size: 16px;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .nav-item:hover {
            background-color: #003bb3;
        }
        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 10px;
            margin-bottom: 20px;
            position: relative;
            top: 20px;
        }
        .image-container {
            position: absolute;
            left: 20%;
            top: 29px;
            transform: translateY(-50%);
            width: 280px;
            height: 80px;
            background: url('../static/dogo.png') center center/contain no-repeat;
            z-index: 999;
            cursor: pointer;
        }
        .header span {
            font-weight: bold;
            position: absolute;
            right: 32%;
            display: flex;
            align-items: center;
            height: 100%;
            top: 22px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }
        .header .search-bar {
            display: flex;
            max-width: 400px;
            height: 48px;
            gap: 0px;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 5px;
        }
        .header .search-bar select {
            padding: 12px 16px;
            border: 1px solid #CCCCCC;
            border-radius: 4px 0 0 4px;
            font-size: 14px;
            min-width: 100px;
        }
        .header .search-input {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            height: 46px;
            top: 1px;
        }
        .header .search-input svg {
            position: absolute;
            left: 16px;
            pointer-events: none;
        }
        .header .search-input input {
            width: 100%;
            height: 46px;
            padding: 0 16px 0 48px;
            border: 1px solid #CCCCCC;
            border-left: none;
            border-right: none;
            font-size: 14px;
        }
        .header .search-input input::placeholder {
            color: #999999;
        }
        .header .search-button {
            padding: 12px 16px;
            background-color: #FF6600;
            color: #FFFFFF;
            border: none;
            border-radius: 0 4px 4px 0;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .header .search-button:hover {
            background-color: #E55C00;
        }
        .header .search-button:active {
            transform: translateY(1px);
        }
        .header .actions {
            display: flex;
            gap: 10px;
            position: absolute;
            right: 29%;
            top: 17px;
        }
        .header button, .header a.button {
            padding: 0;
            cursor: pointer;
            text-decoration: none;
            background-color: transparent;
            border: none;
            color: #333;
        }
        .header a.button:hover {
            color: #0066cc;
        }
        #logout-button {
            font-size: 16px;
            margin-left: 10px;
        }
        #logout-button:hover {
            color: #0066cc;
        }
        
        @media (max-width: 768px) {
            .header .search-bar { height: 40px; }
            .header .search-button span { display: none; }
            .header .search-button::after { content: "üîç"; }
        }
        
        /* Ê†áÈ¢òÊ†∑Âºè‰ºòÂåñ */
        h2 { 
            text-align: center; 
            font-size: 2.5rem; 
            text-shadow: 2px 2px 4px #f0f0f0;
            margin-bottom: 40px;
            margin-top: 100px;
        }
        
        /* ÊôØÁÇπÁΩëÊ†ºÂ∏ÉÂ±Ä */
        .spots-list { 
            list-style: none; 
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            max-width: 660px;
            margin: 0 auto;
            margin-top: 200px;
            display: none; /* ÈöêËóèÂéüÊù•ÁöÑÊé®ËçêÊôØÁÇπÂàóË°® */
        }
        
        @media (max-width: 768px) {
            .spots-list {
                grid-template-columns: 1fr;
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        
        /* ÊôØÁÇπÂç°ÁâáÊ†∑Âºè */
        .spots-list li { 
            border: 1px solid #eee; 
            padding: 0;
            margin-bottom: 0;
            border-radius: 12px;
            overflow: hidden;
            height: 300px;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: translateY(50px);
            animation: fadeInUp 800ms cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            transition: transform 300ms ease, box-shadow 300ms ease;
        }
        
        .spots-list li:nth-child(odd) {
            animation-delay: 100ms;
        }
        
        .spots-list li:nth-child(even) {
            animation-delay: 300ms;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .spots-list li:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        /* ÂõæÁâáÂå∫Âüü */
        .spots-list li img {
            width: 100%;
            height: 50%;
            object-fit: cover;
            overflow: hidden;
            border-radius: 12px 12px 0 0;
            display: block;
            transition: transform 0.3s;
        }

        .spot-info {
            padding: 0.8rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border-bottom: 1px solid #dfe6e9;
        }
        
        .spot-info::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.05);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .spots-list li:hover .spot-info::after {
            opacity: 1;
        }
        
        .spots-list h3 { 
            margin: 0 auto 15px auto; 
            font-size: 1.4rem;
            font-family: 'Noto Sans SC', sans-serif;
            color: #2d3436;
            font-weight: bold;
            text-align: center;
            width: 100%;
        }
        
        .spots-list p { 
            margin: 5px 0; 
            font-size: 0.9em; 
            color: #555;
        }
        
        .view-more {
            display: block;
            text-align: center;
            margin: 0 auto 40px auto;
            padding: 10px 20px;
            background-color: #f8f9fa;
            color: #0052d9;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            text-decoration: none;
            font-size: 14px;
            transition: background-color 0.3s;
            width: fit-content;
        }
        
        .view-more:hover {
            background-color: #e9ecef;
        }
    </style>
</head>
<body>

    <div class="white-container">
        <a href="/spots/search?type=ÂéÜÂè≤Âª∫Á≠ë" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üè∞</i>
            </div>
            <span>ÂéÜÂè≤Âª∫Á≠ë</span>
        </a>
        <a href="/spots/search?type=ËµèËä±ËÉúÂú∞" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üå∏</i>
            </div>
            <span>ËµèËä±ËÉúÂú∞</span>
        </a>
        <a href="/spots/search?type=ËêåËêåÂä®Áâ©" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üêº</i>
            </div>
            <span>ËêåËêåÂä®Áâ©</span>
        </a>
        <a href="/spots/search?type=ÂüéÂ∏ÇÊº´Ê≠•" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üèôÔ∏è</i>
            </div>
            <span>ÂüéÂ∏ÇÊº´Ê≠•</span>
        </a>
        <a href="/spots/search?type=Â§úÊ∏∏ËßÇÊôØ" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üåÉ</i>
            </div>
            <span>Â§úÊ∏∏ËßÇÊôØ</span>
        </a>
        <a href="/spots/search?type=ÈÅõÂ®ÉÂÆùËóèÂú∞" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</i>
            </div>
            <span>ÈÅõÂ®ÉÂÆùËóèÂú∞</span>
        </a>
        <a href="/spots/search?type=Â±ïÈ¶ÜÂ±ïËßà" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üèõÔ∏è</i>
            </div>
            <span>Â±ïÈ¶ÜÂ±ïËßà</span>
        </a>
        <a href="/spots/search?type=Âú∞Ê†áËßÇÊôØ" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üóº</i>
            </div>
            <span>Âú∞Ê†áËßÇÊôØ</span>
        </a>
        <a href="/spots/search?type=ÁôªÈ´òÁà¨Â±±" class="category-item">
            <div class="category-icon">
                <i class="iconfont">‚õ∞Ô∏è</i>
            </div>
            <span>ÁôªÈ´òÁà¨Â±±</span>
        </a>
        <a href="/spots/search?type=Ë∏èÈùíÂøÖÂéª" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üçÉ</i>
            </div>
            <span>Ë∏èÈùíÂøÖÂéª</span>
        </a>
        <a href="/spots/search?type=Ëá™ÁÑ∂Â±±Ê∞¥" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üèûÔ∏è</i>
            </div>
            <span>Ëá™ÁÑ∂Â±±Ê∞¥</span>
        </a>
        <a href="/spots/search?type=Ê∏∏‰πêÂú∫" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üé°</i>
            </div>
            <span>Ê∏∏‰πêÂú∫</span>
        </a>
        <a href="/spots/search?type=ÊºîÂá∫" class="category-item">
            <div class="category-icon">
                <i class="iconfont">üé≠</i>
            </div>
            <span>ÊºîÂá∫</span>
        </a>
    </div>

    <div class="tabs-container">
        <div class="tabs-nav">
            <a href="#" class="tab-item active" data-target="recommended"><strong>Êé®ËçêÊôØÂå∫</strong></a>
            <a href="#" class="tab-item" data-target="5star"><strong>5ÂàÜÊôØÂå∫</strong></a>
            <a href="#" class="tab-item" data-target="4star"><strong>4ÂàÜÊôØÂå∫</strong></a>
            <a href="#" class="tab-item" data-target="3star"><strong>3ÂàÜÊôØÂå∫</strong></a>
            <a href="#" class="tab-item" data-target="shows"><strong>ÊóÖÊ∏∏ÊºîËâ∫</strong></a>
        </div>
        
        <div id="recommended" class="tab-content active">
            <div class="spots-grid" id="recommended-grid">
                <!-- Êé®ËçêÊôØÂå∫Âç°ÁâáÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÂä†ËΩΩ -->
                <div class="spot-card">
                    <div style="height: 150px; background: #eee; display: flex; align-items: center; justify-content: center; color: #aaa;">Âä†ËΩΩ‰∏≠...</div>
                </div>
            </div>
            <a href="/spots/search?user_preference=true&exclude_type=ÊºîÂá∫" class="view-more">Êü•ÁúãÊõ¥Â§ö</a>
        </div>
        
        <div id="5star" class="tab-content">
            <div class="spots-grid" id="5star-grid">
                <!-- 5ÂàÜÊôØÂå∫Âç°ÁâáÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÂä†ËΩΩ -->
            </div>
            <a href="/spots/search?min_score=5.0&max_score=5.0&exclude_type=ÊºîÂá∫" class="view-more">Êü•ÁúãÊõ¥Â§ö</a>
        </div>
        
        <div id="4star" class="tab-content">
            <div class="spots-grid" id="4star-grid">
                <!-- 4ÂàÜÊôØÂå∫Âç°ÁâáÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÂä†ËΩΩ -->
            </div>
            <a href="/spots/search?min_score=4.0&max_score=4.9&exclude_type=ÊºîÂá∫" class="view-more">Êü•ÁúãÊõ¥Â§ö</a>
        </div>
        
        <div id="3star" class="tab-content">
            <div class="spots-grid" id="3star-grid">
                <!-- 3ÂàÜÊôØÂå∫Âç°ÁâáÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÂä†ËΩΩ -->
            </div>
            <a href="/spots/search?min_score=3.0&max_score=3.9&exclude_type=ÊºîÂá∫" class="view-more">Êü•ÁúãÊõ¥Â§ö</a>
        </div>
        
        <div id="shows" class="tab-content">
            <div class="spots-grid" id="shows-grid">
                <!-- ÊóÖÊ∏∏ÊºîËâ∫Âç°ÁâáÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÂä†ËΩΩ -->
            </div>
            <a href="/spots/search?type=ÊºîÂá∫" class="view-more">Êü•ÁúãÊõ¥Â§ö</a>
        </div>
    </div>

    <div class="blue-container">
    <div class="nav-item" onclick="window.location.href='/spots/search'">
        Êé®ËçêÊôØÂå∫
    </div>
    <div class="nav-item" onclick="window.location.href='/spots/spot_info/143'">
        Âè£Á¢ëÊó•ËÆ∞
    </div>
</div>

    <div class="header">
        <a href="/" style="text-decoration: none;">
            <div class="image-container"></div>
        </a>
        <span id="username">ËÆøÂÆ¢</span>
        <div class="search-bar">
            <select aria-label="ÊêúÁ¥¢Á±ªÂûã">
                <option value="spot">ÊôØÂå∫</option>
                <option value="diary">Êó•ËÆ∞</option>
            </select>
            <div class="search-input">
                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="#666666">
                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                </svg>
                <input type="text" placeholder="ËØ∑ËæìÂÖ•ÂÖ≥ÈîÆËØç" aria-label="ÊêúÁ¥¢ÂÖ≥ÈîÆËØç">
            </div>
            <button class="search-button">ÊêúÁ¥¢</button>
        </div>
        <div class="actions">
            <button id="logout-button">ÁôªÂá∫</button>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const usernameSpan = document.getElementById('username');
        const logoutButton = document.getElementById('logout-button');
        const searchBar = document.querySelector('.search-bar');
        const searchSelect = searchBar.querySelector('select');
        const searchInput = searchBar.querySelector('input');
        const searchButton = searchBar.querySelector('.search-button');
        
        // ÈÄâÈ°πÂç°ÂàáÊç¢ÂäüËÉΩ
        const tabs = document.querySelectorAll('.tab-item');
        const contents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                e.preventDefault();
                
                // ÁßªÈô§ÊâÄÊúâÊøÄÊ¥ªÁä∂ÊÄÅ
                tabs.forEach(t => t.classList.remove('active'));
                contents.forEach(c => c.classList.remove('active'));
                
                // ËÆæÁΩÆÂΩìÂâçÈÄâ‰∏≠È°π‰∏∫ÊøÄÊ¥ªÁä∂ÊÄÅ
                tab.classList.add('active');
                
                // Ëé∑ÂèñÂØπÂ∫îÂÜÖÂÆπÂπ∂ÊòæÁ§∫
                const targetId = tab.getAttribute('data-target');
                document.getElementById(targetId).classList.add('active');
                
                // Â¶ÇÊûúÂØπÂ∫îÂÜÖÂÆπ‰∏∫Á©∫ÔºåÂàôÂä†ËΩΩÊï∞ÊçÆ
                const gridElement = document.getElementById(`${targetId}-grid`);
                if (gridElement && gridElement.children.length === 0) {
                    loadTabContent(targetId);
                }
            });
        });
        
        // ÊåâËØÑÂàÜÂä†ËΩΩ‰∏çÂêåÁ±ªÂà´ÁöÑÊôØÂå∫
        function loadTabContent(tabId) {
            const gridElement = document.getElementById(`${tabId}-grid`);
            if (!gridElement) return;
            
            // ÊòæÁ§∫Âä†ËΩΩ‰∏≠
            gridElement.innerHTML = '<div class="spot-card"><div style="height: 150px; background: #eee; display: flex; align-items: center; justify-content: center; color: #aaa;">Âä†ËΩΩ‰∏≠...</div></div>';
            
            // ÊûÑÂª∫APIËØ∑Ê±Ç
            let apiUrl = '/api/search-spots';
            let params = new URLSearchParams();
            
            // Ê†πÊçÆtabIdËÆæÁΩÆ‰∏çÂêåÁöÑÁ≠õÈÄâÊù°‰ª∂
            switch(tabId) {
                case 'recommended':
                    // Êé®ËçêÊôØÂå∫ÔºöÊòæÁ§∫Â∏¶ÊúâÁî®Êà∑Ê≥®ÂÜåÊó∂ÈÄâÊã©ÁöÑÂñúÂ•ΩÊ†áÁ≠æÁöÑÊôØÂå∫ÔºàÂà®Âéªspot_type‰∏∫"ÊºîÂá∫"Ôºâ
                    params.append('exclude_type', 'ÊºîÂá∫');
                    params.append('user_preference', 'true');
                    break;
                case '5star':
                    // 5ÂàÜÊôØÂå∫ÔºöÂè™ÊòæÁ§∫spot.score‰∏∫5.0ÁöÑÊôØÂå∫ÔºàÂà®Âéªspot_type‰∏∫"ÊºîÂá∫"Ôºâ
                    params.append('min_score', '5.0');
                    params.append('max_score', '5.0');
                    params.append('exclude_type', 'ÊºîÂá∫');
                    break;
                case '4star':
                    // 4ÂàÜÊôØÂå∫ÔºöÂè™ÊòæÁ§∫spot.score‰∏∫4.0~4.9ÁöÑÊôØÂå∫ÔºàÂà®Âéªspot_type‰∏∫"ÊºîÂá∫"Ôºâ
                    params.append('min_score', '4.0');
                    params.append('max_score', '4.9');
                    params.append('exclude_type', 'ÊºîÂá∫');
                    break;
                case '3star':
                    // 3ÂàÜÊôØÂå∫ÔºöÂè™ÊòæÁ§∫spot.score‰∏∫3.0~3.9ÁöÑÊôØÂå∫ÔºàÂà®Âéªspot_type‰∏∫"ÊºîÂá∫"Ôºâ
                    params.append('min_score', '3.0');
                    params.append('max_score', '3.9');
                    params.append('exclude_type', 'ÊºîÂá∫');
                    break;
                case 'shows':
                    // ÊóÖÊ∏∏ÊºîËâ∫ÔºöÂè™ÊòæÁ§∫spot_type‰∏∫"ÊºîÂá∫"ÁöÑ
                    params.append('type', 'ÊºîÂá∫');
                    break;
            }
            
            // ÂèëÈÄÅËØ∑Ê±Ç
            fetch(`${apiUrl}?${params.toString()}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success && Array.isArray(data.spots) && data.spots.length > 0) {
                        // Ê∏ÖÁ©∫ÁΩëÊ†º
                        gridElement.innerHTML = '';
                        
                        // ÈôêÂà∂ÊúÄÂ§öÊòæÁ§∫10‰∏™ÊôØÂå∫
                        const spotsToShow = data.spots.slice(0, 10);
                        
                        // Ê∑ªÂä†ÊôØÂå∫Âç°Áâá
                        spotsToShow.forEach(spot => {
                            const spotCard = createSpotCard(spot);
                            gridElement.appendChild(spotCard);
                        });
                    } else {
                        gridElement.innerHTML = '<div class="spot-card"><div style="height: 150px; display: flex; align-items: center; justify-content: center; color: #888;">ÊöÇÊó†Êï∞ÊçÆ</div></div>';
                    }
                    
                    // Á°Æ‰øù"Êü•ÁúãÊõ¥Â§ö"ÊåâÈíÆÂèØËßÅÔºàÊó†ËÆ∫ÊòØÂê¶ÊúâÊï∞ÊçÆÔºâ
                    const viewMoreBtn = document.getElementById(tabId).querySelector('.view-more');
                    if (viewMoreBtn) {
                        viewMoreBtn.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Âä†ËΩΩÊôØÂå∫Êï∞ÊçÆÂá∫Èîô:', error);
                    gridElement.innerHTML = '<div class="spot-card"><div style="height: 150px; display: flex; align-items: center; justify-content: center; color: #888;">Âä†ËΩΩÂá∫ÈîôÔºåËØ∑ÈáçËØï</div></div>';
                    
                    // Á°Æ‰øù"Êü•ÁúãÊõ¥Â§ö"ÊåâÈíÆÂèØËßÅÔºàÂç≥‰ΩøÂá∫ÈîôÔºâ
                    const viewMoreBtn = document.getElementById(tabId).querySelector('.view-more');
                    if (viewMoreBtn) {
                        viewMoreBtn.style.display = 'block';
                    }
                });
        }
        
        // ÂàõÂª∫ÊôØÂå∫Âç°ÁâáÂÖÉÁ¥†
        function createSpotCard(spot) {
            const card = document.createElement('div');
            card.className = 'spot-card';
            
            const id = spot.id || '';
            const name = spot.name || 'Êú™Áü•ÊôØÁÇπ';
            const imgUrl = spot.img || '';
            const score = spot.score || 'N/A';
            // ÊèêÂèñÂú∞ÂùÄ‰ø°ÊÅØ - ÂÅáËÆæinfoÊòØ‰∏Ä‰∏™Êï∞ÁªÑÔºåÈáåÈù¢ÂåÖÂê´Âú∞ÂùÄÂ≠óÊÆµ
            let location = 'Êú™Áü•Âú∞Âå∫';
            if (spot.info && Array.isArray(spot.info)) {
                const addressObj = spot.info.find(item => Object.keys(item)[0] === 'Âú∞ÂùÄ');
                if (addressObj && addressObj['Âú∞ÂùÄ']) {
                    // ÊèêÂèñÂú∞ÂùÄ‰∏≠ÁöÑÁúÅÂ∏Ç‰ø°ÊÅØ (ÁÆÄÂåñÂ§ÑÁêÜ)
                    const addressText = addressObj['Âú∞ÂùÄ'];
                    const provinceMatch = addressText.match(/([^ÁúÅ]+ÁúÅ|Âåó‰∫¨|‰∏äÊµ∑|Â§©Ê¥•|ÈáçÂ∫Ü|Ê±üËãè|ÊµôÊ±ü|ÂÆâÂæΩ|Á¶èÂª∫)/);
                    const cityMatch = addressText.match(/([^Â∏Ç]+Â∏Ç|[^Â∑û]+Â∑û|[^Âéø]+Âéø|[^Âå∫]+Âå∫)/);
                    
                    // ÈÅøÂÖçÈáçÂ§çÂú∞ÁÇπÂêçÁß∞ÔºåÂ¶Ç"ÂõõÂ∑ù ÂõõÂ∑ù"
                    if (provinceMatch && cityMatch) {
                        const province = provinceMatch[0].substring(0, 2);
                        const city = cityMatch[0].substring(0, 2);
                        
                        if (province === city) {
                            location = province;
                        } else {
                            location = `${province} ${city}`;
                        }
                    } else if (provinceMatch) {
                        location = provinceMatch[0].substring(0, 2);
                    } else if (cityMatch) {
                        location = cityMatch[0].substring(0, 2);
                    }
                }
            }
            
            card.innerHTML = `
                ${imgUrl ? `<img src="${imgUrl}" alt="${name}">` : '<div style="height: 130px; background: #eee; display: flex; align-items: center; justify-content: center; color: #aaa;">Êó†ÂõæÁâá</div>'}
                <div class="spot-card-info">
                    <h3><a href="/spots/spot_info/${id}" style="text-decoration: none; color: inherit;">${name}</a></h3>
                    <span class="spot-location">[${location} ${score}ÂàÜ]</span>
                    <div style="clear: both;"></div>
                </div>
            `;
            
            return card;
        }

        // 1. Ê£ÄÊü•‰ºöËØùÂπ∂Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØ
        fetch('/api/check-session')
            .then(response => {
                if (!response.ok) {
                    // Â¶ÇÊûúÊú™ÊéàÊùÉ (401) ÊàñÂÖ∂‰ªñÈîôËØØÔºåÈáçÂÆöÂêëÂà∞ÁôªÂΩïÈ°µ
                    if (response.status === 401) {
                        window.location.href = '/login'; // Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢ÁöÑË∑ØÁî±
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return null; // Èò≤Ê≠¢Ëøõ‰∏ÄÊ≠•Â§ÑÁêÜ
                }
                return response.json();
            })
            .then(data => {
                if (data && data.success) {
                    usernameSpan.textContent = data.user.username || 'Áî®Êà∑';
                    // Áî®Êà∑‰ø°ÊÅØËé∑ÂèñÊàêÂäüÂêéÔºåËé∑ÂèñÊé®ËçêÊôØÁÇπ
                    loadTabContent('recommended');
                } else if (data) {
                     // Âç≥‰ΩøÊàêÂäüÂìçÂ∫îÔºå‰πüÂèØËÉΩ‰∏öÂä°ÈÄªËæëÂ§±Ë¥•
                     console.error('‰ºöËØùÊ£ÄÊü•Â§±Ë¥•:', data.message);
                     window.location.href = '/login';
                }
                // Â¶ÇÊûú response.ok ‰∏∫ false ‰∏îÈùû 401ÔºåÂàô‰∏ç‰ºöÊâßË°åÂà∞ËøôÈáå
            })
            .catch(error => {
                console.error('Ê£ÄÊü•‰ºöËØùÊó∂Âá∫Èîô:', error);
                usernameSpan.textContent = 'ÈîôËØØ';
                // ÂèØÈÄâÔºö‰πüÂú®Ê≠§Â§ÑÈáçÂÆöÂêëÂà∞ÁôªÂΩïÈ°µ
                window.location.href = '/login';
            });

        // 2. Ëé∑ÂèñÊé®ËçêÊôØÁÇπÂáΩÊï∞
        function fetchAndDisplaySpots() {
            fetch('/api/recommended-spots') // ËØ∑Ê±ÇÊñ∞ÁöÑÊé®Ëçê API
                .then(response => {
                    if (!response.ok) {
                         // Â¶ÇÊûúÊú™ÊéàÊùÉÔºå‰πüÈáçÂÆöÂêë
                        if (response.status === 401) {
                            window.location.href = '/login';
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    spotsList.innerHTML = ''; // Ê∏ÖÁ©∫Âä†ËΩΩÊèêÁ§∫
                    if (data.success && data.spots && data.spots.length > 0) {
                        data.spots.forEach(spot => {
                            const li = document.createElement('li');
                            // ÂÆâÂÖ®Âú∞Ëé∑ÂèñÊØè‰∏™Â≠óÊÆµÔºåÊèê‰æõÈªòËÆ§ÂÄº
                            const id = spot.id || 'Êú™Áü•ID';
                            const name = spot.name || 'Êú™Áü•ÊôØÁÇπ';
                            const score = spot.score !== undefined ? spot.score : 'N/A'; // ËØÑÂàÜÂèØËÉΩÊòØ 0
                            const type = spot.type || 'Êú™Áü•Á±ªÂûã';
                            const visitedTime = spot.visited_time || 'Êú™Áü•'; // ÂÅáËÆæ visited_time ÊòØ‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÊèèËø∞ÔºåÂ¶Ç "Á∫¶2Â∞èÊó∂"
                            const imgUrl = spot.img || ''; // ÂõæÁâá URLÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàô‰∏∫Á©∫

                            // ÊûÑÂª∫ÂàóË°®È°πÁöÑ HTML ÂÜÖÂÆπ
                            li.innerHTML = `
                                ${imgUrl ? `<img src="${imgUrl}" alt="${name}" style="max-width: 100px; max-height: 80px; float: left; margin-right: 10px;">` : ''}
                                <h3><a href="/spots/spot_info/${id}">${name}</a></h3> <!-- ‰øÆÊîπËøôÈáåÔºåÂ∞ÜÂêçÂ≠óÂèò‰∏∫ÈìæÊé• -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; font-family: serif; font-size: 0.9rem; line-height: 1.6; color: #636e72;">
                                    <div>ID: ${id}</div>
                                    <div>Ê†áÁ≠æ: ${type}</div>
                                    <div>ËØÑÂàÜ: ${score}</div>
                                    <div>ÊµèËßà: ${visitedTime}</div>
                                </div>
                                <div style="clear: both;"></div> <!-- Ê∏ÖÈô§ÊµÆÂä® -->
                            `;
                            spotsList.appendChild(li);
                        });
                    } else if (data.success) {
                        spotsList.innerHTML = '<li>ÊöÇÊó†Êé®ËçêÊôØÁÇπ„ÄÇ</li>';
                    } else {
                        spotsList.innerHTML = `<li>Âä†ËΩΩÊé®ËçêÊôØÁÇπÂ§±Ë¥•: ${data.message || 'Êú™Áü•ÈîôËØØ'}</li>`;
                    }
                })
                .catch(error => {
                    console.error('Ëé∑ÂèñÊé®ËçêÊôØÁÇπÊó∂Âá∫Èîô:', error);
                    spotsList.innerHTML = '<li>Âä†ËΩΩÊé®ËçêÊôØÁÇπÊó∂Âá∫ÈîôÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ</li>';
                });
        }

        // 3. Â§ÑÁêÜÊêúÁ¥¢
        function handleSearch() {
            const keyword = searchInput.value.trim();
            if (!keyword) {
                // Á©∫ÂÖ≥ÈîÆËØçÊèêÁ§∫
                searchInput.style.borderColor = 'red';
                searchInput.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    searchInput.style.borderColor = '#CCCCCC';
                    searchInput.style.animation = '';
                }, 500);
                return;
            }
            
            const searchType = searchSelect.value;
            const apiUrl = new URL('/api/search-spots', window.location.origin);
            apiUrl.searchParams.append('keyword', keyword);
            if (searchType === 'diary') {
                apiUrl.searchParams.append('type', 'diary');
            }
            
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        if (response.status === 401) {
                            window.location.href = '/login';
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success && Array.isArray(data.spots)) {
                        window.location.href = `/spots/search?keyword=${encodeURIComponent(keyword)}`;
                    } else {
                        showToast('ÊêúÁ¥¢ÊúçÂä°ÊöÇ‰∏çÂèØÁî®ÔºåËØ∑Á®çÂêéÈáçËØï');
                    }
                })
                .catch(error => {
                    console.error('ÊêúÁ¥¢Êó∂Âá∫Èîô:', error);
                    showToast('ÊêúÁ¥¢ÊúçÂä°ÊöÇ‰∏çÂèØÁî®ÔºåËØ∑Á®çÂêéÈáçËØï');
                });
        }
        
        function showToast(message) {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.position = 'fixed';
            toast.style.bottom = '20px';
            toast.style.left = '50%';
            toast.style.transform = 'translateX(-50%)';
            toast.style.backgroundColor = 'rgba(0,0,0,0.7)';
            toast.style.color = 'white';
            toast.style.padding = '10px 20px';
            toast.style.borderRadius = '4px';
            toast.style.zIndex = '1000';
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        searchButton.addEventListener('click', handleSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleSearch();
            }
        });
        
        // 4. Â§ÑÁêÜÁôªÂá∫
        logoutButton.addEventListener('click', () => {
            fetch('/api/logout', { method: 'POST' }) // ÊúÄÂ•Ω‰ΩøÁî® POST ËØ∑Ê±ÇÁôªÂá∫
                .then(response => {
                    // ‰∏çËÆ∫ÊàêÂäü‰∏éÂê¶ÔºåÈÉΩÂ∞ùËØïÈáçÂÆöÂêëÂà∞ÁôªÂΩïÈ°µ
                    window.location.href = '/login'; // ÂÅáËÆæÁôªÂá∫ API ‰ºöÂ§ÑÁêÜÈáçÂÆöÂêëÔºåÊàñËÄÖÂâçÁ´ØÂº∫Âà∂Ë∑≥ËΩ¨
                })
                .catch(error => {
                    console.error('ÁôªÂá∫Êó∂Âá∫Èîô:', error);
                    // Âç≥‰ΩøÂá∫ÈîôÔºå‰πüÂ∞ùËØïË∑≥ËΩ¨
                    window.location.href = '/login';
                });
        });

        // ÂàùÂßãÂä†ËΩΩÊé®ËçêÊôØÂå∫Êï∞ÊçÆ
        loadTabContent('recommended');
    });
</script>

</body>
</html>
