<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user.name }}çš„æ—¥è®° - ä¸ªæ€§åŒ–æ—…æ¸¸ç³»ç»Ÿ</title>
    <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" type="image/png">
    <link rel="shortcut icon" href="{{ url_for('static', filename='logo.png') }}" type="image/png">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/user_diaries.css') }}">
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="header-container">
            <div class="header-left">
                <a href="/spots" class="logo-link">
                    <div class="image-container"></div>
                </a>
            </div>
            
            <div class="header-center">
                <div class="search-bar">
                    <select aria-label="æœç´¢ç±»å‹">
                        <option value="spot">æ™¯åŒº</option>
                        <option value="diary">æ—¥è®°</option>
                    </select>
                    <div class="search-input">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="#666666">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                        <input type="text" placeholder="è¯·è¾“å…¥å…³é”®è¯" aria-label="æœç´¢å…³é”®è¯">
                    </div>
                    <button class="search-button">æœç´¢</button>
                </div>
            </div>
            
            <div class="header-right">
                <div class="user-info">
                    <a id="username" href="#" style="text-decoration: none; color: inherit; cursor: pointer;">{{ user.name }}</a>
                    <button id="logout-button" class="logout-button">ç™»å‡º</button>
                </div>
            </div>
        </div>
    </header>

    <!-- å¯¼èˆªæ¡ -->
    <div class="blue-container">
        <div class="nav-item" onclick="window.location.href='/spots/search'">
            æ¨èæ™¯åŒº
        </div>
        <div class="nav-item" onclick="window.location.href='/diary/search'">
            å£ç¢‘æ—¥è®°
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
        <div class="user-profile-section">
            <div class="user-info-card">
                <div class="user-avatar">
                    <img src="{{ url_for('static', filename='dogo.png') }}" alt="{{ user.name }}">
                </div>
                <div class="user-details">
                    <div class="user-name">{{ user.name }}</div>
                    <div class="user-stats">
                        <div class="stat-item">
                            <span class="stat-number">{{ user.reviews.total if user.reviews else 0 }}</span>
                            <span class="stat-label">æ—…è¡Œæ—¥è®°</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">{{ user.review_marking.get_size() }}</span>
                            <span class="stat-label">æ™¯ç‚¹è¯„ä»·</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ—¥è®°åŒºåŸŸ -->
        <div class="diaries-section">
            <div class="section-header">
                <h2>æˆ‘çš„æ—…è¡Œæ—¥è®°</h2>
                <a href="{{ url_for('diary.add_diary_page') }}" class="write-diary-btn">å†™æ—¥è®°</a>
            </div>
            
            <div class="diary-list">
                {% if diaries %}
                    {% for diary in diaries %}
                    <div class="diary-item" data-diary-id="{{ diary.id }}">
                        <div class="diary-item-content">
                            <h3 class="diary-title">
                                <a href="{{ url_for('diary.get_diary', diary_id=diary.id) }}">{{ diary.title }}</a>
                            </h3>
                            <div class="diary-meta">
                                <span class="meta-item">
                                    <i class="icon">ğŸ“…</i>
                                    {{ diary.time }}
                                </span>
                                <span class="meta-item">
                                    <i class="icon">ğŸ‘ï¸</i>
                                    {{ diary.visited_time }} æ¬¡æµè§ˆ
                                </span>
                                <span class="meta-item rating">
                                    <i class="icon">â­</i>
                                    {{ diary.score }}åˆ†
                                </span>
                            </div>                            <div class="diary-preview">
                                {{ (diary.content or "æš‚æ— å†…å®¹")|truncate(150) }}
                            </div>
                            {% if diary.img_list and diary.img_list|length > 0 %}
                            <div class="diary-preview-images">
                                {% for img in diary.img_list[:3] %}
                                <div class="preview-image">
                                    <img src="{{ url_for('external_static', filename=img) }}" alt="æ—…è¡Œå›¾ç‰‡">
                                </div>
                                {% endfor %}
                                {% if diary.img_list|length > 3 %}
                                <div class="preview-image more-images">
                                    <span>+{{ diary.img_list|length - 3 }}</span>
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}
                            {% if diary.video_path %}
                            <div class="diary-extras">
                                <span class="video-indicator">
                                    <i class="icon">ğŸ¥</i>
                                    åŒ…å«è§†é¢‘
                                </span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="no-diaries">
                        <div class="no-diaries-icon">ğŸ“</div>
                        <h3>æš‚æ— æ—…è¡Œæ—¥è®°</h3>
                        <p>å¿«å»è®°å½•ä½ çš„ç²¾å½©æ—…ç¨‹å§ï¼</p>
                        <a href="{{ url_for('diary.add_diary_page') }}" class="write-diary-btn primary">ç«‹å³å†™æ—¥è®°</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/user_diaries.js') }}"></script>
</body>
</html>
